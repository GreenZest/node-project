{"filter":false,"title":"app.js","tooltip":"/app.js","undoManager":{"mark":6,"position":6,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":85,"column":48},"action":"insert","lines":["var express = require('express'),","\tapp = express(),","\tpassport = require('passport'),","\tcookieParser = require('cookie-parser'),","    bodyParser = require('body-parser'),","    LocalStrategy = require('passport-local').Strategy,","    _ = require('underscore');","","app.set('views', './views');","app.set('view engine', 'jade'); ","","app.use(express.static('assets'));","app.use(express.static('public'));","","app.use(cookieParser());","app.use(bodyParser.urlencoded({ extended: false }));","app.use(bodyParser.json());","","app.use(require('express-session')({ secret: 'ufhgiufighireuthiuhgjkfdhgrueiht' }));","app.use(passport.initialize());","app.use(passport.session());","","passport.use(new LocalStrategy(","","\t{ ","\t\tusernameField: 'username',","    \tpasswordField: 'password' ","    },","","    function(username, password, done){","","    \tvar userlist = [{ username:'cat', password:'meow' },","    \t\t\t\t\t{ username:'dog', password:'woof' },","    \t\t\t\t\t{ username:'bird', password:'chirick' }];","","    \tif(_.filter(userlist, function(user){ ","    \t\treturn(user.username == username ","    \t\t\t&& user.password == password )}).length > 0) ","    \t{","    \t\tdone(null, { username: username,","    \t\t\t\t\t\t\tpassword: password });","","    \t} else {","    \t\tdone(null, false);","    \t}","    }));","","passport.serializeUser(function(user, done) {","  console.log('Сериализуем пользователя');","  done(null, user.username);","});","","passport.deserializeUser(function(id, done) {","  console.log('Десериализуем пользователя ' + id);","  done(null, { username: id });","});","","app.get('/', function(req,res){","\tres.render('index', { name: 'Cat' });","});","","app.get('/greet/:name', function(req,res){","\tres.render('greet', { name: req.params.name });","});","","app.get('/secret', function(req,res){","\tres.setHeader(\"Content-Type\", \"text/html; charset=utf8\");","\tif(req.isAuthenticated())","\t\tres.redirect('/userpage/' + req.user.username);","\telse","\t\tres.redirect('/login');","});","","app.get('/userpage/:name', function(req,res){","\tres.end('hello, '+req.params.name);","})","","app.get('/login', function(req,res){","  res.render('login');","});","","app.post('/login', passport.authenticate('local', { successRedirect: '/secret',","                                                  failureRedirect: '/login' }))","","var server = app.listen('4000');","console.log('server is listening on port 4000');"]}]}],[{"group":"doc","deltas":[{"start":{"row":85,"column":48},"end":{"row":85,"column":49},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":85,"column":49},"end":{"row":85,"column":50},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":85,"column":50},"end":{"row":85,"column":51},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":85,"column":50},"end":{"row":85,"column":51},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":85,"column":49},"end":{"row":85,"column":50},"action":"remove","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":85,"column":48},"end":{"row":85,"column":49},"action":"remove","lines":["g"]}]}]]},"ace":{"folds":[],"scrolltop":915,"scrollleft":0,"selection":{"start":{"row":85,"column":48},"end":{"row":85,"column":48},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":56,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1426801009627,"hash":"e38469c32ef71f96813282098af73e834fe3d927"}